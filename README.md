# shiva karnati

## Local setup (permanent localhost default)

Permanent development ports:
- Frontend: `http://localhost:8080`
- Backend: `http://localhost:4000`

Prerequisites:
- Node.js 18+
- npm
- PostgreSQL

### 1) Install dependencies

```sh
npm install
npm --prefix server install
```

### 2) Configure environment files

Create root `.env` from `.env.example`.

Create `server/.env` from `server/.env.example` and configure at least:
- `DATABASE_URL`
- `JWT_SECRET`
- `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`, `SMTP_FROM`

Optional smoke-test env:
- `DEMO_USER_EMAIL`
- `DEMO_USER_PASSWORD`

### 3) Prepare database

```sh
cd server
npx prisma migrate dev
npx prisma generate
cd ..
```

### 4) Run application

Preferred fixed localhost mode:
```sh
npm run dev:full
```

Alternative auto-fallback mode:
```sh
npm run dev:full:auto
```

Manual split mode:
```sh
npm run dev:backend
npm run dev:frontend:8080
```

## Deploy to Render (Frontend + Backend + Postgres)

This repo now includes a Render Blueprint at `render.yaml`.

### Deploy with Blueprint (recommended)

1. Push this project to GitHub.
2. In Render dashboard, click **New +** -> **Blueprint**.
3. Select your repo and deploy.
4. Render will create:
	- `profile-postgres` (managed Postgres)
	- `profile-backend` (Node web service)
	- `profile-frontend` (static site)

### Required environment variables after Blueprint creation

Set these on **profile-backend**:
- `CORS_ORIGIN` = your frontend Render URL (for example `https://profile-frontend.onrender.com`)
- `FRONTEND_URL` = same as frontend URL
- `PUBLIC_API_URL` = your backend Render URL (for example `https://profile-backend.onrender.com`)
- `SMTP_HOST`
- `SMTP_PORT`
- `SMTP_USER`
- `SMTP_PASS`
- `SMTP_FROM`

Set this on **profile-frontend**:
- `VITE_API_URL` = your backend Render URL (for example `https://profile-backend.onrender.com`)

Notes:
- `DATABASE_URL` is wired automatically from Render Postgres via `render.yaml`.
- `JWT_SECRET` is auto-generated by Render from `render.yaml`.

### Deploy commands used in Render

Backend (`profile-backend`):
- Build command: `npm install && npm run build`
- Start command: `npm run start:render`

`start:render` runs:
1. `prisma generate`
2. `prisma migrate deploy`
3. `node dist/index.js`

Frontend (`profile-frontend`):
- Build command: `npm install && npm run build`
- Publish directory: `dist`

### Post-deploy checklist

1. Open backend health endpoint: `GET /api/health`
2. Open frontend URL and test:
	- OTP request
	- OTP verify + signup/login
	- profile save
	- photo upload
	- resume upload

### Important production note about uploads

Current uploads are stored on local filesystem (`/uploads`) in backend service.

On Render web services, local disk is ephemeral unless you attach a persistent disk, so uploaded files may be lost after redeploy/restart.

For durable production uploads, migrate to object storage (S3/Cloudinary) or attach a persistent disk and point uploads there.

## Script reference

- `npm run dev` -> frontend fixed on `8080`
- `npm run dev:frontend:8080` -> frontend fixed on `8080`
- `npm run dev:frontend:auto` -> frontend tries `8080`, then `8082`, then `5173`
- `npm run dev:backend` -> backend on `4000`
- `npm run dev:full` -> backend + frontend fixed (`4000/8080`)
- `npm run dev:full:auto` -> backend + frontend with frontend fallback ports
- `npm run build` -> frontend production build
- `npm --prefix server run build` -> backend production build
- `powershell -ExecutionPolicy Bypass -File .\smoke-test.ps1` -> smoke tests

## Tech stack

Frontend:
- React + TypeScript + Vite
- Tailwind CSS + shadcn/ui
- TanStack Query

Backend:
- Node.js + Express + TypeScript
- Prisma ORM + PostgreSQL
- JWT + bcryptjs for auth
- Nodemailer (SMTP) for OTP emails
- Multer for profile photo upload handling

## Innovation features and why they help Gidy

1) Skill Endorsement System
- Users can endorse skills and see endorsement counts in profile skills.
- Why chosen: adds trust and social proof to user profiles, helping recruiters/teams quickly evaluate strengths.

2) Interactive Work Timeline
- Experience is shown as an interactive timeline panel, so users can switch timeline items quickly.
- Why chosen: improves scanability of career history and gives Gidy profiles a more engaging professional layout.

3) Persistent Dark Mode
- Theme toggle in navbar persists across sessions.
- Why chosen: improves usability and accessibility for long sessions and low-light usage.

4) AI-Generated Bio Summary (tag-based)
- Profile edit has “Generate AI Summary” using headline, skills, and goals.
- Why chosen: helps users create profile content faster and improves profile completion quality.

5) Production-style Profile Photo Upload + Logout
- Users can upload real image files for profile photos (backend upload endpoint + persisted URL).
- Profile page includes a logout button to clear local session and redirect to login.
- Why chosen: profile photo upload gives stronger personal branding for Gidy users, while logout strengthens account/session safety.

## Profile photo upload notes

- Upload endpoint: `POST /api/profile/:username/photo` (requires Bearer token)
- Form field: `photo`
- Accepted files: images only
- Max size: `5MB`
- Uploaded files are served from `/uploads/...`

## Resume upload notes

- Upload endpoint: `POST /api/profile/:username/resume` (requires Bearer token)
- Form field: `resume`
- Accepted files: `PDF`, `DOC`, `DOCX`
- Max size: `10MB`
- Uploaded files are served from `/uploads/...` and saved to `resumeUrl`

## API highlights

- `GET /api/health`
- `POST /api/auth/request-otp`
- `POST /api/auth/verify-otp`
- `POST /api/auth/register`
- `POST /api/auth/login`
- `GET /api/profile/:username`
- `PUT /api/profile/:username`
- `POST /api/profile/:username/photo`
- `POST /api/profile/:username/resume`
- `POST /api/skills/:skillId/endorse`
- `GET /api/skills/:skillId/endorsements`
